using System;

namespace TOSExpViewer.Core
{
    public class Constants
    {
        internal const string INFINITY = "\u221E";

        internal const int MAX_CLASS_LEVEL = 15;

        internal const int MAX_CLASS_RANK = 10;

        private static readonly int[] REQUIRED_BASE_EXPERIENCE = new int[] {
            12,
            280,
            742,
            1444,
            2434,
            3760,
            5451,
            7651,
            10291,
            13411,
            17051,
            21251,
            26051,
            31457,
            37541,
            39296,
            43806,
            50944,
            60709,
            73211,
            88499,
            106655,
            127802,
            152498,
            180512,
            211892,
            246736,
            285200,
            327374,
            373410,
            423390,
            478140,
            537090,
            600384,
            668087,
            740339,
            817280,
            898965,
            985530,
            1078140,
            1175936,
            1278960,
            1387344,
            1501122,
            1620522,
            1628274,
            1647909,
            1678083,
            1718304,
            1768476,
            1828366,
            1898056,
            1977616,
            2066985,
            2167147,
            2277383,
            2397965,
            2528909,
            2670219,
            2822151,
            2984827,
            3158499,
            3344481,
            3541740,
            3750377,
            3970632,
            4202598,
            4446362,
            4702156,
            4970212,
            5252260,
            5546930,
            5854290,
            6174564,
            6507812,
            6854254,
            7214110,
            7587430,
            7976680,
            8379705,
            8796717,
            9227928,
            9673550,
            10133612,
            10608507,
            10629264,
            10681324,
            10760620,
            10865574,
            10995130,
            11148778,
            11326178,
            11527168,
            11752463,
            12001277,
            12273395,
            12568795,
            12887656,
            13229936,
            13595581,
            13984963,
            14399881,
            14838697,
            15301545,
            15788553,
            16299843,
            16835764,
            17396192,
            17981472,
            18594268,
            19232196,
            19895586,
            20584526,
            21299344,
            22040120,
            22806924,
            23600080,
            24422864,
            25272456,
            26148916,
            27052556,
            27983684,
            28942348,
            29928856,
            30943244,
            31989654,
            33064354,
            34167644,
            35299828,
            36461200,
            37651780,
            38871864,
            40121464,
            41405296,
            42719296,
            42816608,
            43059920,
            43429144,
            43915744,
            44514912,
            45225560,
            46043100,
            46965776,
            47992384,
            49121688,
            50353024,
            51685376,
            53118960,
            54657800,
            56297240,
            58037104,
            59877512,
            61818240,
            63859708,
            66001648,
            68244448,
            70595072,
            73047208,
            75601184,
            78256992,
            81015296,
            83876048,
            86839544,
            89906408,
            93085840,
            96369776,
            99758096,
            103251760,
            106850624,
            110555648,
            114367024,
            118285320,
            122321552,
            126465680,
            130718240,
            135079776,
            139550800,
            144131872,
            148823088,
            153625376,
            158551472,
            163589840,
            168740992,
            174005024,
            179382800,
            179603600,
            180154336,
            180990672,
            182091200,
            183443760,
            185039680,
            186872976,
            188938432,
            191232768,
            193752640,
            196501968,
            199472928,
            202663680,
            206073120,
            209700176,
            213543680,
            217602880,
            221877424,
            226377168,
            231091904,
            236021168,
            241164912,
            246523104,
            252096096,
            257883328,
            263885584,
            270116352,
            276562720,
            283224896,
            290103136,
            297197696,
            304509248,
            312037952,
            319784512,
            327765920,
            335966784,
            344386784,
            353026976,
            361887968,
            370970304,
            380274528,
            389801248,
            399570848,
            409564352,
            419782752,
            430226528,
            440896672,
            451793184,
            462917504,
            474292608,
            474684544,
            475660288,
            477137056,
            479078784,
            481462208,
            484272096,
            487496128,
            491132384,
            495167168,
            499593984,
            504408288,
            509605472,
            515182432,
            521136000,
            527463488,
            534174560,
            541256256,
            548706752,
            556524800,
            564708992,
            573258048,
            582171520,
            591448704,
            601106368,
            611127488,
            621511616,
            632258752,
            643368384,
            654840640,
            666675520,
            678872960,
            691455424,
            704400960,
            717710656,
            731384320,
            745422400,
            759825472,
            774593792,
            789727808,
            805254848,
            821148864,
            837410816,
            854041600,
            871041536,
            888411520,
            906151872,
            924293376,
            942807488,
            961694400,
            980955584,
            981564288,
            983080256,
            985373056,
            988385088,
            992086592,
            996447104,
            1001447616,
            1007072576,
            1013310208,
            1020149760,
            1027583360,
            1035603328,
            1044217088,
            1053406464,
            1063166528,
            1073493632
        };

        private static readonly int[,] REQUIRED_CLASS_EXPERIENCE = new int[,] {
            { 58, 267, 653, 1231, 2011, 3004, 4217, 5657, 7330, 9243, 11399, 13804, 16462, 19377 },
            { 2724, 12519, 30548, 57524, 93983, 140362, 197030, 264311, 342492, 431834, 532575, 644935, 769117, 905313 },
            { 16004, 73536, 179432, 337883, 552038, 824456, 1157312, 1552505, 2011725, 2536501, 3128232, 3788208, 4517628, 5317613 },
            { 57976, 266388, 650005, 1224002, 1999789, 2986641, 4192431, 5624037, 7287587, 9188619, 11332198, 13722998, 16365363, 19263356 },
            { 245833, 1129555, 2756185, 5190075, 8479606, 12664103, 17776956, 23847324, 30901190, 38962040, 48051352, 58188936, 69393224, 81681440 },
            { 535630, 2461111, 6005263, 11308299, 18475632, 27592944, 38732988, 51959300, 67328480, 84891712, 104695792, 126783888, 151196128, 177970080 },
            { 924709, 4248849, 10367454, 19522586, 31896232, 47636312, 66868420, 89702256, 116235528, 146556592, 180746240, 218879008, 261024192, 307246592},
            { 1413534, 6494899, 15847954, 29842720, 48757392, 72818072, 102216768, 137121136, 177680576, 224030144, 276293312, 334584000, 399008192, 469664928 },
            { 2001893, 9198286, 22444384, 42264224, 69051792, 103127304, 144762672, 194195376, 251636960, 317278688, 391295488, 473848672, 565088256, 665154624 },
            { 2689951, 12359771, 30158602, 56790596, 92785144, 138572544, 194518144, 260941056, 338125536, 426328576, 525785184, 636712192, 759311232, 893770752 }
        };

        public static int GetRequiredBaseExperience(int level)
        {
            return REQUIRED_BASE_EXPERIENCE[level - 2];
        }

        public static int GetRequiredClassExperience(int rank, int classLevel)
        {
            GuardRankAndClass(rank, classLevel);

            if (classLevel > 1)
            {
                return REQUIRED_CLASS_EXPERIENCE[rank - 1, classLevel - 1] - REQUIRED_CLASS_EXPERIENCE[rank - 1, classLevel - 2];
            }

            return REQUIRED_CLASS_EXPERIENCE[rank - 1, classLevel - 1];
        }

        public static int GetCurrentClassExperienceForLevelOnly(int currentTotalClassExperience, int rank, int classLevel)
        {
            GuardRankAndClass(rank, classLevel);

            if (classLevel > 1)
            {
                // subtract current experience from previous level required experience to get current experience
                return currentTotalClassExperience - REQUIRED_CLASS_EXPERIENCE[rank - 1, classLevel - 2];
            }
            
            return currentTotalClassExperience;
        }

        private static void GuardRankAndClass(int rank, int classLevel)
        {
            if (rank < 1 || rank > 10)
            {
                throw new ArgumentOutOfRangeException(nameof(rank), "You must use a rank between 1 and 10");
            }
            if (classLevel < 1 || classLevel > 14)
            {
                throw new ArgumentOutOfRangeException(nameof(classLevel), "You must use a class level between 1 and 14");
            }
        }
    }
}
